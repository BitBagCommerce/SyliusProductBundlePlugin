<?xml version="1.0" encoding="UTF-8" ?>

<!--
  ~ This file was created by developers working at BitBag
  ~ Do you need more information about us and what we do? Visit our https://bitbag.io website!
  ~ We are hiring developers from all over the world. Join us and start your new, exciting adventure and become part of us: https://bitbag.io/career
  -->

<resources
        xmlns="https://api-platform.com/schema/metadata/resources-3.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="https://api-platform.com/schema/metadata/resources-3.0 https://api-platform.com/schema/metadata/resources-3.0.xsd"
>
    <resource class="%sylius.model.order.class%" shortName="Order" >

        <normalizationContext>
            <values>
                <value name="groups">admin:order:read</value>
            </values>
        </normalizationContext>

        <validationContext>
            <values>
                <value name="groups">
                    <values>
                        <value>sylius</value>
                    </values>
                </value>
            </values>
        </validationContext>

        <operations>
            <operation
                    name="admin_get"
                    class="ApiPlatform\Metadata\Get"
                    uriTemplate="/admin/orders"
            />

            <operation
                    name="shop_post"
                    class="ApiPlatform\Metadata\Post"
                    uriTemplate="/shop/orders"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Cart\PickupCart"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:order:create</value>
                    </values>
                </denormalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Pickups a new cart. Provided locale code has to be one of available for a particular channel.</value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_get"
                    class="ApiPlatform\Metadata\Get"
                    uriTemplate="/shop/orders"
            >
                <normalizationContext>
                    <values>
                        <value name="groups">shop:order:read</value>
                    </values>
                </normalizationContext>
            </operation>
        </operations>

        <operations>
            <operation
                    name="admin_get"
                    class="ApiPlatform\Metadata\Get"
                    uriTemplate="/admin/orders/{tokenValue}"
            />

            <operation
                    name="shop_get"
                    class="ApiPlatform\Metadata\Get"
                    uriTemplate="/shop/orders/{tokenValue}"
            >
                <normalizationContext>
                    <values>
                        <value name="groups">shop:cart:read</value>
                    </values>
                </normalizationContext>
            </operation>

            <operation
                    name="shop_delete"
                    class="ApiPlatform\Metadata\Delete"
                    uriTemplate="/shop/orders/{tokenValue}"

            >
                <openapiContext>
                    <values>
                        <value name="summary">Deletes cart</value>
                    </values>
                </openapiContext>
                <normalizationContext>
                    <values>
                        <value name="groups">shop:order:read</value>
                    </values>
                </normalizationContext>
            </operation>

            <operation
                    name="admin_cancel"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/admin/orders/{tokenValue}/cancel"
                    input="false"
                    controller="sylius.api.order_state_machine_transition_applicator:cancel"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">admin:order:update</value>
                    </values>
                </denormalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Cancels Order</value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_add_item"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/orders/{tokenValue}/items"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Cart\AddItemToCart"
            >
                <normalizationContext>
                    <values>
                        <value name="groups">shop:cart:read</value>
                    </values>
                </normalizationContext>
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:add_item</value>
                    </values>
                </denormalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Adds Item to cart</value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_add_product_bundle"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/orders/{tokenValue}/product-bundle"
                    status="200"
                    messenger="input"
                    input="BitBag\SyliusProductBundlePlugin\Dto\Api\AddProductBundleToCartDto"
                    output="false"
            >
                <validationContext>
                    <values>
                        <value name="groups">
                            <values>
                                <value>Default</value>
                            </values>
                        </value>
                    </values>
                </validationContext>
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:add_product_bundle</value>
                    </values>
                </denormalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Adds Product Bundle to cart</value>
                        <value name="responses">
                            <values>
                                <value name="200">
                                    <values>
                                        <value name="description">Product bundle added to the cart</value>
                                    </values>
                                </value>
                            </values>
                        </value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_address"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/orders/{tokenValue}/address"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Checkout\UpdateCart"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:address</value>
                    </values>
                </denormalizationContext>
                <normalizationContext>
                    <values>
                        <value name="groups">shop:cart:read</value>
                    </values>
                </normalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Addresses cart to given location, logged in Customer does not have to provide an email</value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_select_shipping_method"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/orders/{tokenValue}/shipments/{shipmentId}"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Checkout\ChooseShippingMethod"
            >
                <validationContext>
                    <values>
                        <value name="groups">
                            <values>
                                <value>sylius</value>
                            </values>
                        </value>
                    </values>
                </validationContext>
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:select_shipping_method</value>
                    </values>
                </denormalizationContext>
                <normalizationContext>
                    <values>
                        <value name="groups">shop:cart:read</value>
                    </values>
                </normalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Selects shipping methods for particular shipment</value>
                        <value name="parameters">
                            <values>
                                <value>
                                    <values>
                                        <value name="name">tokenValue</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                                <value>
                                    <values>
                                        <value name="name">shipmentId</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                            </values>
                        </value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_select_payment_method"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/orders/{tokenValue}/payments/{paymentId}"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Checkout\ChoosePaymentMethod"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:select_payment_method</value>
                    </values>
                </denormalizationContext>
                <normalizationContext>
                    <values>
                        <value name="groups">shop:cart:read</value>
                    </values>
                </normalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Selects payment methods for particular payment</value>
                        <value name="parameters">
                            <values>
                                <value>
                                    <values>
                                        <value name="name">tokenValue</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                                <value>
                                    <values>
                                        <value name="name">paymentId</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                            </values>
                        </value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_account_change_payment_method"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/account/orders/{tokenValue}/payments/{paymentId}"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Account\ChangePaymentMethod"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:order:account:change_payment_method</value>
                    </values>
                </denormalizationContext>
                <normalizationContext>
                    <values>
                        <value name="groups">shop:order:account:read</value>
                    </values>
                </normalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Change the payment method as logged shop user</value>
                        <value name="parameters">
                            <values>
                                <value>
                                    <values>
                                        <value name="name">tokenValue</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                                <value>
                                    <values>
                                        <value name="name">paymentId</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                            </values>
                        </value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="get_configuration"
                    class="ApiPlatform\Metadata\Get"
                    controller="sylius.api.get_configuration_action"
                    uriTemplate="/shop/orders/{tokenValue}/payments/{paymentId}/configuration"
            >
                <openapiContext>
                    <values>
                        <value name="summary">Retrieve payment method configuration</value>
                        <value name="parameters">
                            <values>
                                <value>
                                    <values>
                                        <value name="name">tokenValue</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                                <value>
                                    <values>
                                        <value name="name">paymentId</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                            </values>
                        </value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_complete"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/orders/{tokenValue}/complete"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Checkout\CompleteOrder"
            >
                <validationContext>
                    <values>
                        <value name="groups">
                            <values>
                                <value>sylius</value>
                                <value>sylius_checkout_complete</value>
                            </values>
                        </value>
                    </values>
                </validationContext>
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:complete</value>
                    </values>
                </denormalizationContext>
                <normalizationContext>
                    <values>
                        <value name="groups">shop:cart:read</value>
                    </values>
                </normalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Completes checkout</value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_remove_item"
                    class="ApiPlatform\Metadata\Delete"
                    uriTemplate="/shop/orders/{tokenValue}/items/{itemId}"
                    messenger="input"
                    controller="Sylius\Bundle\ApiBundle\Controller\DeleteOrderItemAction"
                    write="false"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:remove_item</value>
                    </values>
                </denormalizationContext>
                <openapiContext>
                    <values>
                        <value name="parameters">
                            <values>
                                <value>
                                    <values>
                                        <value name="name">tokenValue</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                                <value>
                                    <values>
                                        <value name="name">itemId</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                            </values>
                        </value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_change_quantity"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/orders/{tokenValue}/items/{orderItemId}"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Cart\ChangeItemQuantityInCart"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:change_quantity</value>
                    </values>
                </denormalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Changes quantity of order item</value>
                        <value name="parameters">
                            <values>
                                <value>
                                    <values>
                                        <value name="name">tokenValue</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                                <value>
                                    <values>
                                        <value name="name">orderItemId</value>
                                        <value name="in">path</value>
                                        <value name="required">true</value>
                                        <value name="schema">
                                            <values>
                                                <value name="type">string</value>
                                            </values>
                                        </value>
                                    </values>
                                </value>
                            </values>
                        </value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_apply_coupon"
                    class="ApiPlatform\Metadata\Patch"
                    uriTemplate="/shop/orders/{tokenValue}/apply-coupon"
                    messenger="input"
                    input="Sylius\Bundle\ApiBundle\Command\Checkout\UpdateCart"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">shop:cart:apply_coupon</value>
                    </values>
                </denormalizationContext>
                <openapiContext>
                    <values>
                        <value name="summary">Applies coupon to cart</value>
                    </values>
                </openapiContext>
            </operation>

            <operation
                    name="shop_put"
                    class="ApiPlatform\Metadata\Put"
                    uriTemplate="/shop/orders/{tokenValue}"
            >
                <denormalizationContext>
                    <values>
                        <value name="groups">admin:cart:update</value>
                    </values>
                </denormalizationContext>
            </operation>
        </operations>

        <operations>
            <operation
                    name="items_get_subresource"
                    class="ApiPlatform\Metadata\Get"
                    uriTemplate="/shop/orders/{tokenValue}/items"
            />

            <operation
                    name="shipments_get_subresource"
                    class="ApiPlatform\Metadata\Get"
                    uriTemplate="/admin/orders/{tokenValue}/shipments"
            />

            <operation name="payments_get_subresource"
                       class="ApiPlatform\Metadata\Get"
                       uriTemplate="/admin/orders/{tokenValue}/payments"
            />

            <operation name="adjustments_get_subresource"
                       class="ApiPlatform\Metadata\Get"
                       uriTemplate="/shop/orders/{tokenValue}/adjustments"
            />

            <operation name="payments_methods_get_subresource"
                       class="ApiPlatform\Metadata\Get"
                       uriTemplate="/shop/orders/{tokenValue}/payments/{payments}/methods"
            />

            <operation name="shipments_methods_get_subresource"
                       class="ApiPlatform\Metadata\Get"
                       uriTemplate="/shop/orders/{tokenValue}/shipments/{shipments}/methods"
            />

            <operation name="items_adjustments_get_subresource"
                       class="ApiPlatform\Metadata\Get"
                       uriTemplate="/shop/orders/{tokenValue}/items/{items}/adjustments"
            />
        </operations>

<!--        <property name="id" identifier="false" writable="false" />-->
<!--        <property name="number" identifier="false" writable="false" />-->
<!--        <property name="tokenValue" identifier="true" writable="false" />-->
<!--        <property name="channel" writable="false" />-->
<!--        <property name="customer" writable="false" />-->
<!--        <property name="shipments" writable="false">-->
<!--            <subresource resourceClass="%sylius.model.shipment.class%" />-->
<!--        </property>-->
<!--        <property name="payments" writable="false">-->
<!--            <subresource resourceClass="%sylius.model.payment.class%" />-->
<!--        </property>-->
<!--        <property name="state" writable="false" />-->
<!--        <property name="paymentState" writable="false" />-->
<!--        <property name="shippingState" writable="false" />-->
<!--        <property name="total" writable="false" />-->
<!--        <property name="orderPromotionTotal" writable="false" />-->
<!--        <property name="items" readable="true" writable="true">-->
<!--            <subresource resourceClass="%sylius.model.order_item.class%" />-->
<!--        </property>-->
<!--        <property name="notes" writable="true" />-->
<!--        <property name="itemsTotal" readable="true" />-->
<!--        <property name="taxTotal" readable="true"/>-->
<!--        <property name="adjustments" writable="false">-->
<!--            <subresource resourceClass="%sylius.model.adjustment.class%" />-->
<!--        </property>-->
<!--        <property name="billingAddress" writable="false" />-->
<!--        <property name="shippingAddress" writable="false" />-->
<!--        <property name="localeCode" writable="true" />-->
    </resource>
</resources>
